<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NexusAI Test - AI Service</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      h1 {
        color: #667eea;
        margin-bottom: 8px;
      }
      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 24px;
      }
      .status.online {
        background: #10b981;
        color: white;
      }
      .section {
        margin-bottom: 32px;
        padding: 20px;
        background: #f9fafb;
        border-radius: 8px;
      }
      .section h2 {
        color: #374151;
        font-size: 18px;
        margin-bottom: 16px;
      }
      .api-key-input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Courier New', monospace;
        margin-bottom: 12px;
      }
      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }
      .btn-primary {
        background: #667eea;
        color: white;
      }
      .btn-primary:hover {
        background: #5568d3;
      }
      .btn-secondary {
        background: #10b981;
        color: white;
        margin-left: 8px;
      }
      .prompt-input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        min-height: 100px;
        resize: vertical;
        margin-bottom: 12px;
      }
      .response {
        padding: 16px;
        background: white;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        margin-top: 16px;
        white-space: pre-wrap;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        max-height: 400px;
        overflow-y: auto;
      }
      .loading {
        color: #667eea;
        font-weight: 600;
      }
      .error {
        color: #ef4444;
        font-weight: 600;
      }
      .success {
        color: #10b981;
        font-weight: 600;
      }
      code {
        background: #f3f4f6;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 13px;
      }
      .example-btn {
        display: inline-block;
        padding: 6px 12px;
        background: #f3f4f6;
        border-radius: 6px;
        font-size: 13px;
        margin: 4px;
        cursor: pointer;
        border: 1px solid #e5e7eb;
      }
      .example-btn:hover {
        background: #e5e7eb;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üöÄ NexusAI Test Interface</h1>
      <span class="status online">‚óè ONLINE</span>

      <!-- API Key Section -->
      <div class="section">
        <h2>1. API Key Setup</h2>
        <p style="margin-bottom: 12px; color: #6b7280">Your demo API key:</p>
        <input
          type="text"
          class="api-key-input"
          id="apiKey"
          value="vpn_U5zBa_Ze2a4g5zVcJgl1d9ZLXlDJs6uSOTtlO0QRnTg"
          placeholder="vpn_..."
        />
        <button class="btn btn-primary" onclick="saveApiKey()">
          Save API Key
        </button>
        <button class="btn btn-secondary" onclick="testApiKey()">
          Test Connection
        </button>
        <div id="keyStatus"></div>
      </div>

      <!-- AI Generation Section -->
      <div class="section">
        <h2>2. AI Text Generation</h2>
        <p style="margin-bottom: 12px; color: #6b7280">Try these examples:</p>
        <div>
          <span
            class="example-btn"
            onclick="setPrompt('Explain what a VPN is in simple terms')"
            >VPN Explanation</span
          >
          <span
            class="example-btn"
            onclick="
              setPrompt(
                'Generate a React login component with email and password',
              )
            "
            >React Component</span
          >
          <span
            class="example-btn"
            onclick="
              setPrompt(
                'Create a PostgreSQL schema for a blog with posts, comments, and users',
              )
            "
            >Database Schema</span
          >
        </div>
        <textarea
          class="prompt-input"
          id="prompt"
          placeholder="Type your question or request here..."
        ></textarea>
        <button class="btn btn-primary" onclick="generateAI()">Generate</button>
        <div id="aiResponse"></div>
      </div>

      <!-- SQL Assistant Section -->
      <div class="section">
        <h2>3. SQL Assistant</h2>
        <p style="margin-bottom: 12px; color: #6b7280">
          Generate SQL from natural language:
        </p>
        <input
          type="text"
          class="api-key-input"
          id="sqlQuery"
          placeholder="Get all users created in the last 30 days"
        />
        <button class="btn btn-primary" onclick="generateSQL()">
          Generate SQL
        </button>
        <div id="sqlResponse"></div>
      </div>

      <!-- Usage Stats Section -->
      <div class="section">
        <h2>4. Usage Statistics</h2>
        <button class="btn btn-primary" onclick="getUsage()">
          Check Usage
        </button>
        <div id="usageStats"></div>
      </div>
    </div>

    <script>
      const API_BASE = 'https://chatbuilds.com/api/ai'
      let apiKey = 'vpn_U5zBa_Ze2a4g5zVcJgl1d9ZLXlDJs6uSOTtlO0QRnTg'

      function saveApiKey() {
        apiKey = document.getElementById('apiKey').value
        localStorage.setItem('nexusai_api_key', apiKey)
        document.getElementById('keyStatus').innerHTML =
          '<p class="success" style="margin-top:12px;">‚úì API key saved!</p>'
      }

      async function testApiKey() {
        const statusEl = document.getElementById('keyStatus')
        statusEl.innerHTML =
          '<p class="loading" style="margin-top:12px;">Testing connection...</p>'

        try {
          const response = await fetch(`${API_BASE}/../../usage`, {
            headers: { 'X-API-Key': apiKey },
          })

          if (response.ok) {
            const data = await response.json()
            statusEl.innerHTML = `
                        <div class="response">
                            <p class="success">‚úì API Key Valid!</p>
                            <p>Requests: ${data.requests_used} / ${data.requests_limit}</p>
                            <p>Remaining: ${data.requests_remaining}</p>
                        </div>
                    `
          } else {
            statusEl.innerHTML =
              '<p class="error" style="margin-top:12px;">‚úó Invalid API key</p>'
          }
        } catch (error) {
          statusEl.innerHTML = `<p class="error" style="margin-top:12px;">‚úó Connection error: ${error.message}</p>`
        }
      }

      function setPrompt(text) {
        document.getElementById('prompt').value = text
      }

      async function generateAI() {
        const prompt = document.getElementById('prompt').value
        const responseEl = document.getElementById('aiResponse')

        if (!prompt) {
          responseEl.innerHTML =
            '<p class="error" style="margin-top:12px;">Please enter a prompt</p>'
          return
        }

        responseEl.innerHTML =
          '<p class="loading" style="margin-top:12px;">ü§ñ Generating response...</p>'

        try {
          const response = await fetch(`${API_BASE}/generate`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-API-Key': apiKey,
            },
            body: JSON.stringify({
              prompt: prompt,
              model: 'llama3.2:1b',
              max_tokens: 2000,
            }),
          })

          if (response.ok) {
            const data = await response.json()
            responseEl.innerHTML = `
                        <div class="response">
                            <p class="success">‚úì Response (${data.eval_count} tokens, ${data.cached ? 'cached' : 'generated'})</p>
                            <hr style="margin: 12px 0; border: none; border-top: 1px solid #e5e7eb;">
                            ${data.response}
                        </div>
                    `
          } else {
            const error = await response.json()
            responseEl.innerHTML = `<p class="error" style="margin-top:12px;">‚úó Error: ${error.detail || 'Unknown error'}</p>`
          }
        } catch (error) {
          responseEl.innerHTML = `<p class="error" style="margin-top:12px;">‚úó Network error: ${error.message}</p>`
        }
      }

      async function generateSQL() {
        const query = document.getElementById('sqlQuery').value
        const responseEl = document.getElementById('sqlResponse')

        if (!query) {
          responseEl.innerHTML =
            '<p class="error" style="margin-top:12px;">Please enter a query description</p>'
          return
        }

        responseEl.innerHTML =
          '<p class="loading" style="margin-top:12px;">üîß Generating SQL...</p>'

        try {
          const response = await fetch(`${API_BASE}/sql/assist`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-API-Key': apiKey,
            },
            body: JSON.stringify({
              query: query,
              action: 'generate',
            }),
          })

          if (response.ok) {
            const data = await response.json()
            responseEl.innerHTML = `
                        <div class="response">
                            <p class="success">‚úì SQL Generated</p>
                            <hr style="margin: 12px 0; border: none; border-top: 1px solid #e5e7eb;">
                            ${data.sql || 'No SQL generated'}
                        </div>
                    `
          } else {
            const error = await response.json()
            responseEl.innerHTML = `<p class="error" style="margin-top:12px;">‚úó Error: ${error.detail || 'Unknown error'}</p>`
          }
        } catch (error) {
          responseEl.innerHTML = `<p class="error" style="margin-top:12px;">‚úó Network error: ${error.message}</p>`
        }
      }

      async function getUsage() {
        const responseEl = document.getElementById('usageStats')
        responseEl.innerHTML =
          '<p class="loading" style="margin-top:12px;">üìä Fetching usage stats...</p>'

        try {
          const response = await fetch(`${API_BASE}/../../usage`, {
            headers: { 'X-API-Key': apiKey },
          })

          if (response.ok) {
            const data = await response.json()
            const percentage = (
              (data.requests_used / data.requests_limit) *
              100
            ).toFixed(1)
            responseEl.innerHTML = `
                        <div class="response">
                            <p class="success">‚úì Usage Statistics</p>
                            <hr style="margin: 12px 0; border: none; border-top: 1px solid #e5e7eb;">
                            <p><strong>Requests Used:</strong> ${data.requests_used} / ${data.requests_limit} (${percentage}%)</p>
                            <p><strong>Remaining:</strong> ${data.requests_remaining}</p>
                            <p><strong>Resets:</strong> ${new Date(data.window_reset).toLocaleString()}</p>
                        </div>
                    `
          } else {
            responseEl.innerHTML =
              '<p class="error" style="margin-top:12px;">‚úó Failed to fetch usage</p>'
          }
        } catch (error) {
          responseEl.innerHTML = `<p class="error" style="margin-top:12px;">‚úó Network error: ${error.message}</p>`
        }
      }

      // Load saved API key on page load
      window.onload = function () {
        const saved = localStorage.getItem('nexusai_api_key')
        if (saved) {
          apiKey = saved
          document.getElementById('apiKey').value = saved
        }
      }
    </script>
  </body>
</html>
